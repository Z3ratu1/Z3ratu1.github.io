<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.z3ratu1.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="k8s入门没事做和rmb聊天的时候，因为最近确实不知道该学啥，就扯淡的时候聊到k8s，然后想了一下感觉k8s确实很行，之前菊花入职网易的时候上手的业务也是k8s部署的，云越来越成熟的情况下学一手不是坏事 入门的一大问题在于资料有一点散，加上学习不可能有实际生产环境的部署情况，官方资料也很乱，看了一大堆文档才把各个环节理清楚 环境部署推荐使用kind，用docker作为node，2c4g的机器也能轻">
<meta property="og:type" content="article">
<meta property="og:title" content="k8s入门">
<meta property="og:url" content="https://blog.z3ratu1.cn/k8s%E5%85%A5%E9%97%A8.html">
<meta property="og:site_name" content="Z3ratu1&#39;s blog">
<meta property="og:description" content="k8s入门没事做和rmb聊天的时候，因为最近确实不知道该学啥，就扯淡的时候聊到k8s，然后想了一下感觉k8s确实很行，之前菊花入职网易的时候上手的业务也是k8s部署的，云越来越成熟的情况下学一手不是坏事 入门的一大问题在于资料有一点散，加上学习不可能有实际生产环境的部署情况，官方资料也很乱，看了一大堆文档才把各个环节理清楚 环境部署推荐使用kind，用docker作为node，2c4g的机器也能轻">
<meta property="og:locale">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/k8s%E5%85%A5%E9%97%A8/image-20230302162522959.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/k8s%E5%85%A5%E9%97%A8/image-20230302163105610.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/k8s%E5%85%A5%E9%97%A8/image-20230301222419106.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/k8s%E5%85%A5%E9%97%A8/image-20230302150735363.png">
<meta property="article:published_time" content="2023-03-01T13:33:18.000Z">
<meta property="article:modified_time" content="2023-03-09T09:18:50.853Z">
<meta property="article:author" content="Z3ratu1">
<meta property="article:tag" content="docker">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.z3ratu1.cn/images/k8s%E5%85%A5%E9%97%A8/image-20230302162522959.png">

<link rel="canonical" href="https://blog.z3ratu1.cn/k8s%E5%85%A5%E9%97%A8.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>k8s入门 | Z3ratu1's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z3ratu1's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Z3ratu1" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.z3ratu1.cn/k8s%E5%85%A5%E9%97%A8.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://q2.qlogo.cn/headimg_dl?dst_uin=1207039417&spec=160">
      <meta itemprop="name" content="Z3ratu1">
      <meta itemprop="description" content="与其感慨路难行，不如现在出发">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z3ratu1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          k8s入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-01 21:33:18" itemprop="dateCreated datePublished" datetime="2023-03-01T21:33:18+08:00">2023-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-09 17:18:50" itemprop="dateModified" datetime="2023-03-09T17:18:50+08:00">2023-03-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          
            <span id="/k8s%E5%85%A5%E9%97%A8.html" class="post-meta-item leancloud_visitors" data-flag-title="k8s入门" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/k8s%E5%85%A5%E9%97%A8.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/k8s%E5%85%A5%E9%97%A8.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="k8s入门"><a href="#k8s入门" class="headerlink" title="k8s入门"></a>k8s入门</h1><p>没事做和rmb聊天的时候，因为最近确实不知道该学啥，就扯淡的时候聊到k8s，然后想了一下感觉k8s确实很行，之前菊花入职网易的时候上手的业务也是k8s部署的，云越来越成熟的情况下学一手不是坏事</p>
<p>入门的一大问题在于资料有一点散，加上学习不可能有实际生产环境的部署情况，官方资料也很乱，看了一大堆文档才把各个环节理清楚</p>
<p>环境部署推荐使用kind，用docker作为node，2c4g的机器也能轻松部署4个node的集群</p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><p>开始之前还是先把所有的名词搞懂<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kubernetes.io/zh-cn/docs/concepts/overview/components/">Kubernetes 组件</a><br><img src="/images/k8s%E5%85%A5%E9%97%A8/image-20230302162522959.png" alt="image-20230302162522959"></p>
<h3 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h3><p>即集群，k8s的集群由多个node组成，也就是一堆可用的机器，一个集群上面可以部署各种各样不同的服务，使用<code>kubectl cluster-info</code>可以看到目前连接的是哪个集群，输出内容为当前集群的api server端口</p>
<h3 id="node"><a href="#node" class="headerlink" title="node"></a>node</h3><p>节点，在生产环境中表现为物理机或虚拟机<br>节点分为两种，master节点和worker节点，master节点上运行了一系列的管理服务，负责管理整个集群。worker节点则负责打工，worker上需要装kubelet和容器运行时，前者用于和master通信，管理当前节点上运行的pod（感觉网络搭建负载均衡什么的应该也有），后者用来作为容器的运行环境，一般情况下为docker</p>
<h3 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h3><p>k8s中最小的资源调度单位<br>一个pod中可以运行多个容器（docker），同一个pod内的所以容器共享同一个网络和文件系统，但同一个node中的不同pod相互隔离，每个pod拥有一个k8s的独立内网ip，如下图</p>
<p><img src="/images/k8s%E5%85%A5%E9%97%A8/image-20230302163105610.png" alt="image-20230302163105610"></p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>使用kind的话通过构造了一个能运行docker的docker，将docker作为k8s的节点，而不是物理机虚拟机，可以极大程度的节约资源，用破烂搭建起测试环境。</p>
<p>启动环境也很简单，写一个config.yaml，然后<code>kind create cluster -n &lt;cluster_name&gt; --config config.yaml</code>，-n指定的是cluster的名字，样例config.yaml如下</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kind.x<span class="token punctuation">-</span>k8s.io/v1alpha4
<span class="token key atrule">nodes</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> control<span class="token punctuation">-</span>plane
<span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
<span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
<span class="token punctuation">-</span> <span class="token key atrule">role</span><span class="token punctuation">:</span> worker
</code></pre>
<p>启动一个一个master三个worker的集群，该命令还会在<code>~/.kube/config</code>中写入对应集群的配置文件。这之后就没有kind什么事了，他的功能就是快速的为我们搭建一个简易的k8s集群，虽然每个节点都是docker，但也是可以跑起来的，接下来就需要使用kubectl对集群进行操作了（kubectl需要用snap单独装一下）</p>
<p>也还有其他的搭建k8s集群的方案，minikube是用虚拟机作为节点搭建的，也支持一键搭，更原始的方案应该是用VMware之类的起几个虚拟机，然后上去手动装kubectl套件和docker，选择其中的一个作为master节点，然后其他的几个作为worker节点，手动连接到master加入集群<br>如下是ChatGPT给出的命令</p>
<pre><code>kubeadm init --pod-network-cidr=&lt;POD_CIDR&gt;
kubeadm join &lt;MASTER_IP&gt;:&lt;PORT&gt; --token &lt;TOKEN&gt; --discovery-token-ca-cert-hash sha256:&lt;CERT_HASH&gt;
</code></pre>
<p>想运行自己的docker的话，kind也支持将image导入节点中，不过注意在build的时候要指定image的版本号，不要默认的<code>latest</code>，导入命令如下<br><code>kind load docker-image &lt;image_name&gt; -n &lt;cluster_name&gt;</code><br>使用该命令查看image有没有被导入<br><code>docker exec -it &lt;container_name&gt; crictl images</code><br>导入进去之后image会有一个<code>docker.io/library/</code>的前缀，导致我一开始以为没导入进去找半天</p>
<p>之后在k8s拉起环境的时候image处添加一项<code>imagePullPolicy: IfNotPresent</code>即可使用本地镜像</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>各种命令有一个官方小抄<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/">kubectl Cheat Sheet</a></p>
<h3 id="pod-1"><a href="#pod-1" class="headerlink" title="pod"></a>pod</h3><p>pod是k8s中最小的资源调度单位，一个pod运行一个最小的功能系统，不过实际上pod在k8s中是经常销毁和重建的，一般来说部署应用并不使用pod，官方的教程里面也没有直接创建pod</p>
<p>操作pod的命令倒是可以记一下</p>
<pre class=" language-cmd"><code class="language-cmd">kubectl get pods <pod_name>
kubectl describe pods <pod_name>
kubectl get pods -o wide    # 可以看到每个pod被部署到哪个机器上
kubectl delete pods <pod_name>
kubectl exec <pod_name>  -- <cmd>
</cmd></pod_name></pod_name></pod_name></pod_name></code></pre>
<p>exec和docker exec差不多，要交互式shell的时候还需要加一个<code>-it</code></p>
<h3 id="deployment"><a href="#deployment" class="headerlink" title="deployment"></a>deployment</h3><p>正式的部署操作以deployment为主，后续的大部分操作也都是以deployment为操作单位进行的。deployment部署时可以指定部署的pod数量，以及运行的镜像。deployment会保证服务的有效性，当一个pod挂掉的时候会创建新的来补上，并且可以部署的pod上进行负载均衡等操作</p>
<pre class=" language-cmd"><code class="language-cmd">kubectl create deployment <deploy_name> --image <image> --replicas <number>
kubectl get deployments.apps
kubectl describe deployments.apps -n <name>
kubectl delete deployments.apps <name>
</name></name></number></image></deploy_name></code></pre>
<p>deployment部署的pod都会以deployment的名字开头并追加一个随机字符串，如果用delete pod删掉其中的一个，deployment就会创建一个新的来顶替他，以保证一直有replicas个数量的pod能够提供服务</p>
<h3 id="replicas"><a href="#replicas" class="headerlink" title="replicas"></a>replicas</h3><p>可以通过如下命令手动更改副本的数量，副本并不会挂机，而是会被负载均衡进行请求分发<br><code>kubectl scale deployment &lt;deployment_name&gt; --replicas 4</code></p>
<h3 id="service"><a href="#service" class="headerlink" title="service"></a>service</h3><p>一层网络抽象，可以把分散在各个node上的pod暴露出来，提供服务并进行负载均衡</p>
<p>用deployment起了4个redis，然后用service NodePort把端口暴露出来，这里可以看一眼<code>NodePort</code>的表述</p>
<blockquote>
<ul>
<li>ClusterIP (默认) - 在集群的内部 IP 上公开 Service 。这种类型使得 Service 只能从集群内访问。</li>
<li>NodePort - 使用 NAT 在集群中每个选定 Node 的相同端口上公开 Service 。使用&lt;NodeIP&gt;:&lt;NodePort&gt; 从集群外部访问 Service。是 ClusterIP 的超集。</li>
<li>LoadBalancer - 在当前云中创建一个外部负载均衡器(如果支持的话)，并为 Service 分配一个固定的外部IP。是 NodePort 的超集。</li>
<li>ExternalName - 通过返回带有该名称的 CNAME 记录，使用任意名称(由 spec 中的externalName指定)公开 Service。不使用代理。这种类型需要kube-dns的v1.7或更高版本。</li>
</ul>
</blockquote>
<p>等于说这个service对应的所有worker都会开那个端口，然后访问任意一个worker的端口都会由k8s把请求分配到一个pod上，连worker1端口写的数据并不一定会写到worker1上运行的pod中，即使worker1上没有运行pod，但只要worker1是当前deployment中可用的worker，也可以通过连接worker1上对应的端口来访问pod</p>
<p>试了一下写数据，实测证明这个并不会同步，随机连上去写一个pod，再次访问连上的pod不一定有这个数据</p>
<p>service用官方文档的这个图解释就很好<br><img src="/images/k8s%E5%85%A5%E9%97%A8/image-20230301222419106.png" alt="image-20230301222419106"></p>
<p>首先每个pod在k8s集群中有自己的ip，service将所有的pod打一个包，以一个ip暴露出来，就是<code>ClusterIP</code>的形式，而选用<code>NodePort</code>形式，则将每个node的对应端口再暴露一层，但实际上访问node的端口，最后会转发到service上，再分配给每个pod。有了service的包裹，所有对pod的访问全都在service层面接受再分发，使得单个pod的销毁和新建都不会影响服务的稳定性</p>
<blockquote>
<p>Service 通过一组 Pod 路由通信。Service 是一种抽象，它允许 Pod 死亡并在 Kubernetes 中复制，而不会影响应用程序。在依赖的 Pod (如应用程序中的前端和后端组件)之间进行发现和路由是由Kubernetes Service 处理的。</p>
</blockquote>
<p>不过实际应用的时候感觉<code>LoadBalancer</code>会更加合理，不需要每个worker都开对应端口，只有一个负载均衡在外面接受请求。试了一下这个选项外部IP分配不出来。。。感觉正常使用情况估计是充钱云服务商会提供现成的</p>
<p>kind拉起的环境是可以配负载均衡的， 配出来之后可以在docker对应的网段拉出来一个LoadBalancer，在vps范围内可以访问，这里是官方教程<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kind.sigs.k8s.io/docs/user/loadbalancer/">kind-LoadBalancer</a><br>非常好用的能够把service再暴露到kubectl所在机器的命令，可以把kind搭起来的docker k8s暴露出来了</p>
<p><code>kubectl port-forward services/&lt;svc_name&gt; --address 0.0.0.0 &lt;listen_port&gt;:&lt;dst_port&gt;</code></p>
<p>但是这里存在一个迷之坑点，port-forward好像会将所有的请求都分配到一个pod上，而不是原来的负载均衡情况，如果是生产环境的话负loadBalancer和NodePort就直接在公网上开放服务了，kind搭的内网环境下就体现为vps能直接访问，再套到公网的话需要一个其他的端口转发再转一道</p>
<h3 id="pod更新"><a href="#pod更新" class="headerlink" title="pod更新"></a>pod更新</h3><p><img src="/images/k8s%E5%85%A5%E9%97%A8/image-20230302150735363.png" alt="image-20230302150735363"></p>
<p>鉴于这个非常强大的负载均衡，可以对容器进行更新操作，如上图所示，对于一个多pod的deployment，更新是逐步实现的，通过逐个替换pod以实现对整个deployment的更新。默认情况下每次重启一个pod，并且就算更新跑爆了，也还能一键回滚，好人啊</p>
<p>不过用起来有很多注意点，命令如下</p>
<pre class=" language-cmd"><code class="language-cmd">kubectl set image deployments/<deploy_name> <container_name>=<image>
kubectl rollout status deployments/<deploy_name>    # 查看状态
kubectl rollout undo deployments/<deploy_name>    # 回滚
</deploy_name></deploy_name></image></container_name></deploy_name></code></pre>
<p>更新时第二个参数是container name，而不是pod name，因为一个pod实际上是可以有多个container的，更新需要指定更新的是哪一个，所以需要指定的是pod里面的container</p>
<h2 id="进阶操作（大概）"><a href="#进阶操作（大概）" class="headerlink" title="进阶操作（大概）"></a>进阶操作（大概）</h2><p>另分一类是因为k8s官方文档把这些操作放在基础教程的外面。。。</p>
<h3 id="configMap"><a href="#configMap" class="headerlink" title="configMap"></a>configMap</h3><p>用来给容器添加环境变量的操作，除了configmap还有secret，不过secret默认是用base64加密的，容器在创建时可以通过如下配置以获取config</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> APP_NAME
    <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
        <span class="token key atrule">configMapKeyRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> sys<span class="token punctuation">-</span>app<span class="token punctuation">-</span>name
        <span class="token key atrule">key</span><span class="token punctuation">:</span> name
</code></pre>
<p>如上配置从configMap中的<code>sys-app-name</code>表中取出name的值作为环境变量APP_NAME</p>
<pre class=" language-yaml"><code class="language-yaml">        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SYSTEM_APP_USERNAME
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> sys<span class="token punctuation">-</span>app<span class="token punctuation">-</span>credentials
              <span class="token key atrule">key</span><span class="token punctuation">:</span> username
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SYSTEM_APP_PASSWORD
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretKeyRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">name</span><span class="token punctuation">:</span> sys<span class="token punctuation">-</span>app<span class="token punctuation">-</span>credentials
              <span class="token key atrule">key</span><span class="token punctuation">:</span> password
</code></pre>
<p>上述配置则是从secret中的<code>sys-app-credentials</code>中取出username和password作为对应环境变量的值</p>
<p>配置了如上config的pod，在创建时如果没有对应的config，会出现一个<code>CreateContainerConfigError</code>，只有当创建了对应的配置项后才会进入ready状态<br>创建以及查看config&#x2F;secret的命令</p>
<pre><code>kubectl create configmap sys-app-name --from-literal name=my-system
kubectl create secret generic sys-app-credentials --from-literal username=bob --from-literal password=bobpwd
kubectl get configmap sys-app-name -o yaml
kubectl get secret sys-app-credentials -o yaml
</code></pre>
<p>可以看到secret的输出默认是base64的</p>
<p>官网上还有一个用configMap写配置文件的操作，不过需要注意的是，对config的更新是不会立即应用到pod上的，需要重启pod才能生效<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kubernetes.io/zh-cn/docs/tutorials/configuration/configure-redis-using-configmap/">使用 ConfigMap 来配置 Redis</a></p>
<h3 id="volume"><a href="#volume" class="headerlink" title="volume"></a>volume</h3><p>教程中还有一节部署无状态应用，用PHP和redis搭了一个留言板，redis三份，一份leader两份follower，不过镜像的具体实现并没有给出，就只能简单的拉起几个deployment，然后开service把端口暴露出来</p>
<p>有状态的应用中，提出了卷概念，可以在cluster中创建一份volume，并将其挂载在各pod的对应目录上，来实现数据的共享和持久化，解决之前说的一个pod改了其他pod不变的问题</p>
<p>测试的时候volume类型为hostPath，仅在pod对应的node上创建，不能在多节点中共享。可以看官方文档中卷相关节获取关于共享卷的信息<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">持久卷</a></p>
<h3 id="StatefulSet"><a href="#StatefulSet" class="headerlink" title="StatefulSet"></a>StatefulSet</h3><p>deployment的有状态版本，会在创建的时候给每个pod分配一个序列号，被销毁和调度的pod会不会像deployment一样重新拉一个随机id，而是按照之前的序列号重建，并且把原来的全套资源再恢复上去。<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://draveness.me/kubernetes-statefulset/">详解 Kubernetes StatefulSet 实现原理</a>这篇文章里面给出了一个两个replicas的statefulset，并且给他们各自挂载了一份持久数据卷，我一开始还以为是两个共享一份，结果是两个每个一份，创建的两个pod web-0&#x2F;1。尝试对web-0卷上的数据进行修改，并不会影响到web-1上的数据，但是如果将web-0销毁，重新创建的web-0会继承之前的卷，也就是保留了刚才的修改</p>
<p>StatefulSet主要是为了留存数据，所以其环境清理也复杂一点，直接删除statefulset是不会清理相关卷的，所以还需要单独把相关卷的声明给删掉<br><code>kubectl delete persistentvolumeclaim</code></p>
<p>教程中的几个statefulSet的volume都是每个节点各自申请一份然后保证这个volume持续和对应pod绑定，并没有那种我想象中的一个volume多个节点共享以实现同步捏。。。<br>最后一个超长的zooKeeper教程（没有动手实践），也是每个pod挂载自己对应的volume，依靠zooKeeper自身的分布式同步功能对数据进行同步（但是我并不是很了解这个东西）</p>
<p>最后还提到了隔离和腾空操作，这个可以主动将一个节点腾空，要求上面的pod迁移到其他的节点上，是直接把一个机器给禁用了，在机房需要分批维护的时候应该有很大的作用</p>
<h2 id="动手实践"><a href="#动手实践" class="headerlink" title="动手实践"></a>动手实践</h2><p>搭了一个简单的flask app，用loadBalance负载均衡，有一个文件上传和下载功能，为了保证负载均衡后文件下载也能正常使用，还需要创建一个nfs作为持久卷，然后将nfs挂载到每个pod的上传目录</p>
<h3 id="nfs-server-hostPath-volume"><a href="#nfs-server-hostPath-volume" class="headerlink" title="nfs server+hostPath volume"></a>nfs server+hostPath volume</h3><p>首先起一个nfs文件系统，同样使用k8s部署，但是nfs需要上privilege，nfs只需要一个，设置为stateful set，为了数据持久化，nfs server用于共享的目录也需要是一份持久卷，简单起见直接使用hostPath，绑定在对应的node上，但是一旦pod被调度，hostPath的数据就会丢失，所以还需要将pod绑定在对应的某个server上</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StatefulSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>server
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>server
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>server
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/hostname</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>worker
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>server
        <span class="token key atrule">image</span><span class="token punctuation">:</span> itsthenetwork/nfs<span class="token punctuation">-</span>server<span class="token punctuation">-</span>alpine<span class="token punctuation">:</span><span class="token number">12</span>
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">2049</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mountd
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">20048</span>
          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> rpcbind
            <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">111</span>
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SHARED_DIRECTORY
          <span class="token key atrule">value</span><span class="token punctuation">:</span> /nfsshare
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> upload<span class="token punctuation">-</span>data
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /nfsshare
  <span class="token key atrule">volumeClaimTemplates</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> upload<span class="token punctuation">-</span>data
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token string">"ReadWriteOnce"</span> <span class="token punctuation">]</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">requests</span><span class="token punctuation">:</span>
          <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
</code></pre>
<p>没有指定storageClassName，默认为standard，使用的type为hostPath，可以<code>kubectl describe pv</code>看一下</p>
<h3 id="nfs-service"><a href="#nfs-service" class="headerlink" title="nfs service"></a>nfs service</h3><p>其次需要将nfs server暴露出来，让其他node创建节点时可以访问到这个文件系统<br>一开始是按照官方的<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/kubernetes/examples/tree/master/staging/volumes/nfs">nfs example</a>，创建一个headless service，然后直接用pod在集群内的域名访问，顶级优雅，域名格式为<code>&lt;podname&gt;.&lt;namespace&gt;.svc.cluster.local</code>。但是我实际用起来的时候node是无法认出这个域名的，只有集群内部的pod能够使用该域名访问，感觉都是过的kube proxy对集群内部的网络进行处理，但是node本身执行这些命令是不会过proxy的，就跑不起来，一开始不知道什么情况乱按测试浪费了一晚上。。。最后看到了一个和我一模一样情况的issue，<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/kubernetes/examples/issues/390">NFS example with a cluster local service name only works on GKE but not for minikube&#x2F;kubeadm</a>，似乎是云服务的玄幻生产环境下可以用，自己部署的环境就用不了捏</p>
<p>最后也是套了一个loadBalancer把nfs暴露出来，NodePort也行，但是都是暴露到公网，并且使用ip访问，还需要手动配置，都不如这个集群内域名优雅</p>
<h3 id="制备pv-x2F-pvc"><a href="#制备pv-x2F-pvc" class="headerlink" title="制备pv&#x2F;pvc"></a>制备pv&#x2F;pvc</h3><p>pod使用持久卷似乎都需要通过pvc声明占有，然后pvc再去找对应的pv使用。这里有一点抽象，就是那个storageClass，好像能乱写名字？只要pv和pvc的能对应上就行，然后制备pv的时候在属性里面手动配置对应类中的字段即可。。。反正昨天问chatgpt给了我一堆垃圾回答，不能信。。。</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">"nfs"</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.18.255.201
    <span class="token comment" spellcheck="true">#server: nfs-server.default.svc.cluster.local</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"/"</span>
</code></pre>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>claim
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">volumeName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token string">"nfs"</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
</code></pre>
<p>这里应该是静态制备，就先搓一个pv然后pvc靠storageClassName对上了，手写一个配置好的storageClass配好nfs相关属性，可能就可以不声明pv，直接用这个class自动创建pv了</p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://kubernetes.io/zh-cn/docs/concepts/storage/persistent-volumes/">持久卷</a></p>
<blockquote>
<p>如果管理员所创建的所有静态 PV 卷都无法与用户的 PersistentVolumeClaim 匹配， 集群可以尝试为该 PVC 申领动态制备一个存储卷。 这一制备操作是基于 StorageClass 来实现的：PVC 申领必须请求某个 存储类， 同时集群管理员必须已经创建并配置了该类，这样动态制备卷的动作才会发生。 如果 PVC 申领指定存储类为 “”，则相当于为自身禁止使用动态制备的卷。</p>
</blockquote>
<p>还可以看一下这个<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://boilingfrog.github.io/2021/07/01/k8s%E4%B8%AD%E7%9A%84PV%E5%92%8CPVC%E7%90%86%E8%A7%A3/">k8s中的PV和PVC理解</a></p>
<h3 id="app-deployment"><a href="#app-deployment" class="headerlink" title="app deployment"></a>app deployment</h3><p>上述操作完成之后就可以部署app了<br>用的自己写的一个flask app，再起一个loadBalancer给他暴露出公网即可</p>
<p>这里可以考虑使用initContainer对nfs服务进行等待之类的</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flask<span class="token punctuation">-</span>app
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">6</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> flask<span class="token punctuation">-</span>app
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> flask<span class="token punctuation">-</span>app
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flask<span class="token punctuation">-</span>app
        <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/library/flask_app<span class="token punctuation">:</span>v1
        <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"128Mi"</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"256Mi"</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"200m"</span>
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /app/upload
          <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>volume
        <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
          <span class="token key atrule">claimName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>claim
</code></pre>
<p>跑起来的app共享同一个上传目录，负载均衡下上传的所有文件都能进行共享</p>
<h2 id="end"><a href="#end" class="headerlink" title="end"></a>end</h2><p>感觉，上手之后不是很难，对着把命令都按一遍多操作几次就有一定的基础认知了，kind强力推荐，用docker起环境真的很节约资源，低配置下也能搭起来一个节点数还可以的集群，快进到扩展阅读容器安全<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/neargle/my-re0-k8s-security">neargle&#x2F;my-re0-k8s-security</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/docker/" rel="tag"># docker</a>
              <a href="/tags/k8s/" rel="tag"># k8s</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/CS%20DNS%20beacon%E4%BA%8C%E6%AC%A1%E5%BC%80%E5%8F%91%E6%8C%87%E5%8C%97.html" rel="prev" title="CS DNS beacon二次开发指北">
      <i class="fa fa-chevron-left"></i> CS DNS beacon二次开发指北
    </a></div>
      <div class="post-nav-item">
    <a href="/hxpCTF2022wp.html" rel="next" title="hxpCTF2022wp">
      hxpCTF2022wp <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#k8s%E5%85%A5%E9%97%A8"><span class="nav-number">1.</span> <span class="nav-text">k8s入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="nav-number">1.1.</span> <span class="nav-text">名词解释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cluster"><span class="nav-number">1.1.1.</span> <span class="nav-text">cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#node"><span class="nav-number">1.1.2.</span> <span class="nav-text">node</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pod"><span class="nav-number">1.1.3.</span> <span class="nav-text">pod</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.2.</span> <span class="nav-text">环境搭建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-number">1.3.</span> <span class="nav-text">基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pod-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">pod</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#deployment"><span class="nav-number">1.3.2.</span> <span class="nav-text">deployment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#replicas"><span class="nav-number">1.3.3.</span> <span class="nav-text">replicas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#service"><span class="nav-number">1.3.4.</span> <span class="nav-text">service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pod%E6%9B%B4%E6%96%B0"><span class="nav-number">1.3.5.</span> <span class="nav-text">pod更新</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%E6%93%8D%E4%BD%9C%EF%BC%88%E5%A4%A7%E6%A6%82%EF%BC%89"><span class="nav-number">1.4.</span> <span class="nav-text">进阶操作（大概）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#configMap"><span class="nav-number">1.4.1.</span> <span class="nav-text">configMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#volume"><span class="nav-number">1.4.2.</span> <span class="nav-text">volume</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#StatefulSet"><span class="nav-number">1.4.3.</span> <span class="nav-text">StatefulSet</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%89%8B%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.5.</span> <span class="nav-text">动手实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#nfs-server-hostPath-volume"><span class="nav-number">1.5.1.</span> <span class="nav-text">nfs server+hostPath volume</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nfs-service"><span class="nav-number">1.5.2.</span> <span class="nav-text">nfs service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E5%A4%87pv-x2F-pvc"><span class="nav-number">1.5.3.</span> <span class="nav-text">制备pv&#x2F;pvc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app-deployment"><span class="nav-number">1.5.4.</span> <span class="nav-text">app deployment</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#end"><span class="nav-number">1.6.</span> <span class="nav-text">end</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Z3ratu1" src="https://q2.qlogo.cn/headimg_dl?dst_uin=1207039417&spec=160">
  <p class="site-author-name" itemprop="name">Z3ratu1</p>
  <div class="site-description" itemprop="description">与其感慨路难行，不如现在出发</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">181</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">93</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">湘ICP备2020021580号 </a>
      <img src="/./images/beian.png" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Z3ratu1</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '7H8kg0XdWO8IbhOcu4K1JaAT-gzGzoHsz',
      appKey     : 'wPKQjkbVtvPaRR7gh2yjfLSi',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
